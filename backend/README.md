# ScanFood API Server

This is the backend server for the ScanFood application. It provides endpoints for food image recognition and nutritional information retrieval using Google Gemini AI.

## Features

- Food recognition from images using Google Gemini Pro Vision API
- Nutritional information generated by Gemini AI
- Food search functionality
- Error handling and validation
- Simple caching for performance

## Prerequisites

- Node.js 16.x or higher
- npm or yarn
- Google Gemini API key (required)

## Setup

1. Install dependencies:
   ```
   npm install
   ```

2. Create a `.env` file in the root directory based on `.env.example`:
   ```
   cp .env.example .env
   ```

3. Add your Gemini API key to the `.env` file:
   ```
   GEMINI_API_KEY=your_gemini_api_key_here
   ```

## Running the Server

Start the development server:
```
npm run dev
```

For production:
```
npm start
```

The server will run on port 3000 by default, or the port specified in your `.env` file.

## How It Works

This server leverages Google's Gemini AI to perform both food recognition and nutritional analysis:

1. When you upload a food image, Gemini Pro Vision analyzes it to identify the food
2. For detailed nutritional information, Gemini Pro generates comprehensive nutritional data
3. All data is formatted to match the frontend's expected structure
4. Results are cached to improve performance for repeated queries

## API Endpoints

### Recognize Food

```
POST /api/food/recognize
```

Upload an image to recognize the food.
- **Content-Type:** `multipart/form-data`
- **Body:** Form data with an `image` field containing the image file

#### Example Response:
```json
{
  "id": "food_1628945872_apple",
  "name": "Apple",
  "confidence": 0.95,
  "possibleAlternatives": ["Red Apple", "Gala Apple"],
  "description": "A fresh red apple",
  "calories": 52,
  "nutrients": {
    "carbs": 14,
    "protein": 0.3,
    "fat": 0.2
  },
  "message": "Food recognized successfully"
}
```

### Get Food Details

```
GET /api/food/:id
```

Get detailed nutritional information for a food item.

#### Example Response:
```json
{
  "id": "food_1628945872_apple",
  "name": "Apple",
  "imagePlaceholder": "üçé",
  "description": "A fresh, crisp fruit with a sweet flavor and numerous health benefits.",
  "calories": 52,
  "ingredients": [
    {
      "name": "Apple",
      "weight": "100g",
      "calories": 52
    }
  ],
  "nutrients": [
    {
      "name": "Carbs",
      "amount": "14g",
      "rda": "10.8%"
    },
    {
      "name": "Protein",
      "amount": "0.3g",
      "rda": "0.6%"
    },
    {
      "name": "Fat",
      "amount": "0.2g",
      "rda": "0.3%"
    },
    {
      "name": "Fiber",
      "amount": "2.4g",
      "rda": "9.6%"
    },
    {
      "name": "Sugar",
      "amount": "10.4g",
      "rda": "41.6%"
    }
  ]
}
```

### Search Food

```
GET /api/food/search/:query
```

Search for food items by name.

#### Example Response:
```json
{
  "results": [
    {
      "id": "food_1628945872_apple",
      "name": "Apple",
      "calories": 52,
      "imagePlaceholder": "üçé"
    }
  ],
  "count": 1,
  "query": "apple"
}
```

## Integration with Frontend

The frontend application is configured to connect to this API server. Update the `CORS_ORIGIN` in your `.env` file to match your frontend's URL if needed.

## Error Handling

The server returns appropriate HTTP status codes and error messages. For example:

```json
{
  "error": {
    "message": "Invalid image format. Please upload JPEG, PNG, or WebP images.",
    "status": 400
  }
}
``` 